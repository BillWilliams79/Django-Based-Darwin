{% extends "wi/task_base.html" %}

{% block HeadTitle %} Tasks {% endblock %} 

{% block PageTitle %}  {% endblock %} 

{% block mainpagedisplay %}
<div class="container-fluid">
    {% if not domain_count %}
    <form action="" method="post">
        <br>
        <p> No domains defined for this account. Domains and areas are required to track and manage tasks. Please add one or more domains to continue. </p>
        <input type="button" class='btn btn-dark btn' onclick="window.location='{% url 'wi:domain_multiedit' %}'; return false;" value="Edit Domains">
        <br>
        <br>
    </form>
    {% else %}
        <form action="" method="post">
            <h3 class="bg-white mt-4 mb-3 m-0 p-0 g-0" style="z-index: 1;">
                {% if domain_count > 1 %}
                    <button type="submit" name="domain_left" class='btn btn-dark btn-sm'> <i class="fas fa-arrow-left"></i> </button> 
                {% endif %}
                {{ domain_name }} Tasks
                {% if domain_count > 1 %}
                    <button type="submit" name="domain_right" class='btn btn-dark btn-sm'> <i class="fas fa-arrow-right"></i> </button>
                {% endif %}
                {% if area_form_list|length > 0 %}
                    {% if show_done %}
                        <button type="submit" name="hide_done" class='btn btn-dark btn-sm' style="float: right"> Hide Done </button>
                    {% else %}
                        <button type="submit" name="show_done" class='btn btn-dark btn-sm' style="float: right"> Show Done </button>
                    {% endif %}
                {% endif %}
            </h3>
            {% csrf_token %}
            {% if area_form_list|length == 0 %}
                <br>
                <p> No areas defined for this domain. Areas are required to track and manage tasks. Please add areas to continue. </p>
                <input type="button" class='btn btn-dark btn' onclick="window.location='{% url 'wi:area_multiedit' %}'; return false;" value="Edit Areas">
                <br>
                <br>
            {% else %}
                <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-2 row-cols-xl-3 row-cols-xxl-4", style="overflow: hidden">
                    {% for area_obj, area_form in area_form_list %}
                        <div class="col card">
                            <div class="card-body p-3">
                                <h5 class="card-title"> <a href="{% url 'wi:task_areafocus' area_obj.id %}", style="text-decoration: none; color: black"> {{area_obj.name}} Tasks  <i class="fas fa-edit fa-xs"></i></a> 
                                    {% if area_form_list|length > 1 %}
                                        <button type="submit" name="navigate_down" class='btn btn-dark btn-sm' style="float: right" value="{{area_obj.name}}"> <i class="fas fa-caret-down fa-lg"></i> </button>
                                        <button type="submit" name="navigate_up" class='btn btn-dark btn-sm' style="float: right" value="{{area_obj.name}}"> <i class="fas fa-caret-up fa-lg"></i> </button>
                                    {% endif %}
                                </h5>
                                <div class="card-text">
                                    {{ area_form.management_form }}
                                    <table class='table table-hover table-sm' sytle="font-size: 12px">
                                        <thead> 
                                            <tr class="d-flex" style='font-size: 12px;'>
                                                {% for field in area_form.form.visible_fields %}
                                                    {% if field.name == "area" %}
                                                    {% else %}
                                                        <th class="p-0">{{ field.label_tag }} </th>
                                                    {% endif %}
                                                {% endfor %}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for form in area_form %}
                                                <tr class="d-flex pt-1" style='font-size: 12px;'>
                                                    {% for field in form.visible_fields %}
                                                        <td class="p-0 border-0">
                                                            {{ field }}
                                                        </td>
                                                    {% endfor %}
                                                </tr>                         
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    <br>
                                    <input type="submit" name="{{area_obj.name | lower}}" class='btn btn-dark btn' value="Update">
                                    <span>
                                    {% for form in area_form %}
                                        {% for hidden in form.hidden_fields %}
                                            {{ hidden }}
                                        {% endfor %}
                                    {% endfor %}
                                    </span>            
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </form>
    {% endif %}
</div>
<script type="text/javascript">

    $(document).ready(
        function() {
            $(".task-description").attr('rows', '1');
            
            $(".task-description").parent().css('width', '100%');

            $(".task-description").css('height', function() {
                this.style.height = "";
                this.style.height = this.scrollHeight + "px";
            });

            $(window).resize(function() {
                $(".task-description").css('height', function() {
                    this.style.height = "";
                    this.style.height = this.scrollHeight + "px";
                });
            });

            $(".task-description").on('input', function() {
                this.style.height = "";
                this.style.height = this.scrollHeight + "px";
            });

            $(".task-priority").css('width', '24px');
            $(".task-status").css('width', '48px');
            $("thead th:first-child" ).css('width', '24px');
            $("thead th:nth-child(2)" ).css('width', '48px');

            $(".task-status").on('click', function() {
                    var task_description_id = this.id.replace('status', 'description');
                    $("#" + task_description_id).css('text-decoration', this.checked ? 'line-through' : 'none');
                    $("#" + task_description_id).prop('disabled', this.checked ? true : false);
            });


        }
        )
        
</script>


{% endblock%}